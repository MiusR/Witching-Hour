execute as @e[tag=!rtimer,tag=cmgc,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]}] at @s if entity @e[tag=magicaltar,distance=..20,scores={Power=700..}] if entity @e[type=item,distance=..3,nbt={Item:{id:"minecraft:golden_apple",Count:1b}}] if entity @e[type=item,distance=..3,nbt={Item:{tag:{id:"spectral_dust"},Count:1b}}] run scoreboard players set @e[tag=magicaltar,distance=..20,limit=1,scores={Power=700..}] mb_PowerCost 700
execute as @e[tag=!rtimer,tag=cmgc,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]}] at @s if entity @e[tag=magicaltar,distance=..20,scores={Power=700..}] if entity @e[type=item,distance=..3,nbt={Item:{id:"minecraft:golden_apple",Count:1b}}] if entity @e[type=item,distance=..3,nbt={Item:{tag:{id:"spectral_dust"},Count:1b}}] run tag @s add ritualofthegate
execute as @e[tag=cmgc,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]}] at @s if entity @e[tag=magicaltar,distance=..20,scores={Power=700..}] if entity @e[type=item,distance=..3,nbt={Item:{id:"minecraft:golden_apple",Count:1b}}] if entity @e[type=item,distance=..3,nbt={Item:{tag:{id:"spectral_dust"},Count:1b}}] run tag @s add rtimer
execute as @e[tag=cmgc,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]}] at @s if entity @e[tag=magicaltar,distance=..20,scores={Power=700..}] if entity @e[type=item,distance=..3,nbt={Item:{id:"minecraft:golden_apple",Count:1b}}] if entity @e[type=item,distance=..3,nbt={Item:{tag:{id:"spectral_dust"},Count:1b}}] run playsound minecraft:block.note_block.bell master @a[distance=..20] ~ ~ ~ 50 0.7
execute as @e[tag=cmgc,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]}] at @s if entity @e[tag=magicaltar,distance=..20,scores={Power=700..}] if entity @e[type=item,distance=..3,nbt={Item:{id:"minecraft:golden_apple",Count:1b}}] if entity @e[type=item,distance=..3,nbt={Item:{tag:{id:"spectral_dust"},Count:1b}}] run kill @e[distance=..3,type=item]
execute as @e[tag=cmgc,tag=rtimer,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]},scores={Timer=30..},tag=ritualofthegate] at @s run playsound minecraft:block.lava.extinguish master @a[distance=..20] ~ ~ ~ 50 1
execute as @e[tag=cmgc,tag=rtimer,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]},scores={Timer=30..},tag=ritualofthegate] at @s run setblock ~ ~1 ~ chest
execute as @e[tag=cmgc,tag=rtimer,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]},scores={Timer=30..},tag=ritualofthegate] at @s run forceload add ~ ~ ~ ~
execute as @e[tag=cmgc,tag=rtimer,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]},scores={Timer=30..},tag=ritualofthegate] at @s run gamemode adventure @a[distance=..6,limit=1]
execute as @e[tag=cmgc,tag=rtimer,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]},scores={Timer=30..},tag=ritualofthegate] at @s run data modify block ~ ~1 ~ Items set from entity @a[distance=..6,limit=1] Inventory
execute as @e[tag=cmgc,tag=rtimer,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]},scores={Timer=30..},tag=ritualofthegate] at @s run clear @a[distance=..6,limit=1]
execute as @e[tag=cmgc,tag=rtimer,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]},scores={Timer=30..},tag=ritualofthegate] at @s run tag @a[distance=..6,limit=1] add movetoSoulDim
execute as @e[tag=cmgc,tag=rtimer,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]},scores={Timer=30..},tag=ritualofthegate] at @s run tag @s remove rtimer
execute as @e[tag=cmgc,nbt={ActiveEffects:[{Id:1b,Amplifier:-1b}]},scores={Timer=30..},tag=ritualofthegate] run tag @s remove ritualofthegate